var e=Object.defineProperty,a=(a,t,r)=>((a,t,r)=>t in a?e(a,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):a[t]=r)(a,"symbol"!=typeof t?t+"":t,r);import{g as t,e as r,u as s,j as n,s as o,a as i,f as l,c as d,b as c,B as u,T as h,d as x,A as p,F as j,C as m,h as g,i as f}from"./index-BtTxyVhS.js";import{b as v}from"./vendor-B0SxJBnB.js";import{T as b,a as y,I as P,S,b as w,c as C,d as _,e as $,f as A,g as D,h as I,D as R,i as z,j as T,A as W,k as N,P as k}from"./produtos.service-DX7ngikH.js";import{S as U}from"./ShoppingCart-DGlaFtRq.js";function E(e){return t("MuiTableFooter",e)}r("MuiTableFooter",["root"]);const L=o("tfoot",{name:"MuiTableFooter",slot:"Root",overridesResolver:(e,a)=>a.root})({display:"table-footer-group"}),M={variant:"footer"},B="tfoot",F=v.forwardRef((function(e,a){const t=s({props:e,name:"MuiTableFooter"}),{className:r,component:o=B,...d}=t,c={...t,component:o},u=(e=>{const{classes:a}=e;return l({root:["root"]},E,a)})(c);return n.jsx(b.Provider,{value:M,children:n.jsx(L,{as:o,className:i(u.root,r),ref:a,role:o===B?null:"rowgroup",ownerState:c,...d})})})),O=d(n.jsx("path",{d:"M19 13H5v-2h14z"})),q=d(n.jsx("path",{d:"M16.75 13.96c.25.13.41.2.46.3.06.11.04.61-.21 1.18-.2.56-1.24 1.1-1.7 1.12-.46.02-.47.36-2.96-.73-2.49-1.09-3.99-3.75-4.11-3.92-.12-.17-.96-1.38-.92-2.61.05-1.22.69-1.8.95-2.04.24-.26.51-.29.68-.26h.47c.15 0 .36-.06.55.45l.69 1.87c.06.13.1.28.01.44l-.27.41-.39.42c-.12.12-.26.25-.12.5.12.26.62 1.09 1.32 1.78.91.88 1.71 1.17 1.95 1.3.24.14.39.12.54-.04l.81-.94c.19-.25.35-.19.58-.11l1.67.88M12 2a10 10 0 0 1 10 10 10 10 0 0 1-10 10c-1.97 0-3.8-.57-5.35-1.55L2 22l1.55-4.65A9.969 9.969 0 0 1 2 12 10 10 0 0 1 12 2m0 2a8 8 0 0 0-8 8c0 1.72.54 3.31 1.46 4.61L4.5 19.5l2.89-.96A7.95 7.95 0 0 0 12 20a8 8 0 0 0 8-8 8 8 0 0 0-8-8z"})),V=async e=>{try{console.log("Iniciando busca com filtros:",e);return(await c.get("/api/v1/unidades",{params:e})).data}catch(a){throw console.error("Erro na busca:",a),a}};const G=new class{constructor(){a(this,"baseUrl","/api/v1/carrinhos")}async listar(){return(await c.get(this.baseUrl)).data}async buscarPorId(e){return(await c.get(`${this.baseUrl}/${e}`)).data}async buscarPorUnidade(e){return(await c.get(`${this.baseUrl}/unidade/${e}`)).data}async criar(e){return(await c.post(this.baseUrl,e)).data}async atualizar(e,a){return(await c.put(`${this.baseUrl}/${e}`,a)).data}async atualizarStatus(e,a){return(await c.patch(`${this.baseUrl}/${e}/status`,{status:a})).data}async atualizarStatusRetirada(e,a){return(await c.patch(`${this.baseUrl}/${e}/status-retirada`,{status_retirada:a})).data}async excluir(e){await c.delete(`${this.baseUrl}/${e}`)}},H=o(D)((({theme:e})=>({"&.MuiTableCell-head":{backgroundColor:e.palette.primary.main,color:e.palette.common.white,fontWeight:"bold"}}))),J=o($)((({theme:e})=>({"&:nth-of-type(odd)":{backgroundColor:e.palette.action.hover},"&:hover":{backgroundColor:e.palette.action.selected}}))),Q=o("span")((({status:e})=>{let a="#e0e0e0",t="#000000";switch(e){case"Ativo":a="#4caf50",t="#ffffff";break;case"Inativo":a="#f44336",t="#ffffff"}return{backgroundColor:a,color:t,padding:"3px 10px",borderRadius:"12px",display:"inline-block",fontSize:"0.875rem",fontWeight:"500"}})),X=o("span")((({status:e})=>{let a="#e0e0e0",t="#000000";switch(e){case"Retirado":a="#4caf50",t="#ffffff";break;case"Não Retirado":a="#f44336",t="#ffffff"}return{backgroundColor:a,color:t,padding:"3px 10px",borderRadius:"12px",display:"inline-block",fontSize:"0.875rem",fontWeight:"500"}}));function K(){const[e,a]=v.useState([]),[t,r]=v.useState(""),[s,o]=v.useState(""),[i,l]=v.useState(""),[d,c]=v.useState(""),[b,E]=v.useState(""),[L,M]=v.useState(!1),[B,K]=v.useState(""),[Y,Z]=v.useState(0),[ee,ae]=v.useState(10),[te,re]=v.useState(!1),[se,ne]=v.useState(null),[oe,ie]=v.useState([]),[le,de]=v.useState(!1),[ce,ue]=v.useState({}),[he,xe]=v.useState(new Date),[pe,je]=v.useState("Aberto"),[me,ge]=v.useState("Aguardando"),[fe,ve]=v.useState(!1),[be,ye]=v.useState(null),[Pe,Se]=v.useState(""),we=async()=>{try{M(!0),K("");const e={};t&&(e.nomeunidade=t),s&&(e.pessoa=s),i&&(e.id_carrinho=Number(i)),d&&(e.status_carrinho=d),b&&(e.status_retirada=b);const r=[...await V(e)].sort(((e,a)=>e.nomeunidade.localeCompare(a.nomeunidade,"pt-BR")));a(r),Z(0)}catch(e){K(`Erro ao buscar unidades: ${e.message}`)}finally{M(!1)}},Ce=async()=>{try{de(!0);const e=await k.listar();ie(e.filter((e=>"Ativo"===e.status)))}catch(e){K(`Erro ao carregar produtos: ${e.message}`)}finally{de(!1)}};v.useEffect((()=>{const e=setTimeout((()=>{we()}),500);return()=>clearTimeout(e)}),[t,s,i,d,b]);const _e=e.slice(Y*ee,Y*ee+ee),$e=async e=>{var a,t,r;try{M(!0),Se(""),ne(e);const a=(await G.buscarPorUnidade(e.id_unidade))[0];if(a){const e=await G.buscarPorId(a.id_carrinho);ye(a.id_carrinho),ve(!0),xe((e=>{const[a,t]=e.split(" "),[r,s,n]=a.split("/"),[o,i]=t.split(":");return new Date(Number(n),Number(s)-1,Number(r),Number(o),Number(i))})(a.data)),je(a.status),ge(a.status_retirada),await Ce();const t=e.itens.reduce(((e,a)=>({...e,[a.id_produto]:a.quantidade})),{});ue(t)}else await Ae();re(!0)}catch(s){if(404!==(null==(a=s.response)?void 0:a.status)){let e="Erro ao carregar carrinho";(null==(r=null==(t=s.response)?void 0:t.data)?void 0:r.error)?e=s.response.data.error:s.message&&(e=s.message),Se(e)}else await Ae(),re(!0)}finally{M(!1)}},Ae=async()=>{ye(null),ve(!1),xe(new Date),je("Aberto"),ge("Aguardando"),ue({}),await Ce()},De=async()=>{re(!1),ne(null),ve(!1),xe(new Date),je("Aberto"),ge("Aguardando"),ue({}),ye(null),Se(""),we()},Ie=e=>e.toLocaleString("pt-BR",{style:"currency",currency:"BRL"}),Re=()=>oe.reduce(((e,a)=>{const t=ce[a.id_produto]||0;return e+a.valor*t}),0),ze=async(e,a)=>{if(e.celular)try{const t=e.celular.replace(/\D/g,""),r=await(async(e,a,t,r)=>{let s="";const n=be||e.id_carrinho;"Pago"===r?(s=`Olá ${e.pessoa}!\n\n`,s+=`Seu pedido ${n?`#${n}`:""} está pronto para retirada.\n\n`,s+="*Instruções de Retirada:*\n",s+="1. Dirija-se ao local de retirada\n",n&&(s+=`2. Informe o número do seu pedido: #${n}\n`),s+=`3. Status atual: ${me}\n\n`,s+="*Dados do Cliente:*\n",s+=`Unidade: ${e.nomeunidade}\n`,s+=`Pessoa: ${e.pessoa}\n`,s+=`Tipo: ${e.tipo}\n\n`,s+="*Detalhes do Pedido:*\n"):(s=`Olá ${e.pessoa}!\n\n`,s+="*Dados do Cliente:*\n",s+=`Unidade: ${e.nomeunidade}\n`,s+=`Pessoa: ${e.pessoa}\n`,s+=`Tipo: ${e.tipo}\n\n`,s+="*Detalhes do Pedido:*\n");let o=a,i=t;if(!te&&e.id_carrinho)try{const a=await G.buscarPorId(e.id_carrinho);a&&(o=(await k.listar()).filter((e=>"Ativo"===e.status)),i=a.itens.reduce(((e,a)=>({...e,[a.id_produto]:a.quantidade})),{}))}catch(d){console.error("Erro ao buscar detalhes do carrinho:",d)}let l=0;return o.forEach((e=>{const a=i[e.id_produto]||0;if(a>0){const t=e.valor*a;l+=t,s+=`- ${e.descricao}: ${a} x ${Ie(e.valor)} = ${Ie(t)}\n`}})),s+=`\n*Total: ${Ie(l)}*`,"Aberto"===r&&(s+="\n\nChave PIX (CNPJ): 25.044.410/0001-65",n&&(s+=`\n\nFavor incluir na descrição: Pedido #${n}`)),encodeURIComponent(s)})(e,oe,ce,a),s=`https://wa.me/55${t}?text=${r}`;window.open(s,"_blank")}catch(t){console.error("Erro ao enviar mensagem:",t),alert("Erro ao preparar a mensagem. Por favor, tente novamente.")}else alert("Esta unidade não possui número de celular cadastrado.")};return n.jsxs(u,{sx:{p:3},children:[n.jsx(h,{variant:"h4",component:"h1",gutterBottom:!0,sx:{color:"primary.main",fontWeight:"medium"},children:"Venda de Pulseiras"}),n.jsx(x,{sx:{p:2,mb:3},children:n.jsxs(u,{sx:{display:"flex",flexDirection:{xs:"column",md:"row"},gap:2},children:[n.jsx(u,{sx:{flex:1},children:n.jsx(y,{fullWidth:!0,label:"Nome da Unidade",value:t,onChange:e=>r(e.target.value),InputProps:{startAdornment:n.jsx(P,{position:"start",children:n.jsx(S,{})})}})}),n.jsx(u,{sx:{flex:1},children:n.jsx(y,{fullWidth:!0,label:"Nome da Pessoa",value:s,onChange:e=>o(e.target.value),InputProps:{startAdornment:n.jsx(P,{position:"start",children:n.jsx(S,{})})}})}),n.jsx(u,{sx:{flex:1},children:n.jsx(y,{fullWidth:!0,label:"Nº do Pedido",value:i,onChange:e=>{const a=e.target.value.replace(/\D/g,"");l(a)},InputProps:{startAdornment:n.jsx(P,{position:"start",children:n.jsx(S,{})})}})}),n.jsx(u,{sx:{flex:1},children:n.jsxs(y,{fullWidth:!0,select:!0,label:"Status do Pedido",value:d,onChange:e=>c(e.target.value),SelectProps:{native:!0},InputLabelProps:{shrink:!0},children:[n.jsx("option",{value:"",children:"Todos"}),n.jsx("option",{value:"Sem Pedido",children:"Sem Pedido"}),n.jsx("option",{value:"Aberto",children:"Aberto"}),n.jsx("option",{value:"Pago",children:"Pago"}),n.jsx("option",{value:"Cancelado",children:"Cancelado"})]})}),n.jsx(u,{sx:{flex:1},children:n.jsxs(y,{fullWidth:!0,select:!0,label:"Status de Retirada",value:b,onChange:e=>E(e.target.value),SelectProps:{native:!0},InputLabelProps:{shrink:!0},children:[n.jsx("option",{value:"",children:"Todos"}),n.jsx("option",{value:"Sem Pedido",children:"Sem Pedido"}),n.jsx("option",{value:"Aguardando",children:"Aguardando"}),n.jsx("option",{value:"Separado",children:"Separado"}),n.jsx("option",{value:"Retirado",children:"Retirado"}),n.jsx("option",{value:"Cancelado",children:"Cancelado"})]})})]})}),B&&n.jsx(p,{severity:"error",sx:{mb:2},children:B}),n.jsxs(x,{children:[n.jsx(j,{in:!L,timeout:L?0:1e3,children:n.jsx(w,{children:n.jsxs(C,{children:[n.jsx(_,{children:n.jsxs($,{children:[n.jsx(H,{sx:{width:100,minWidth:100},children:"Ações"}),n.jsx(H,{children:"ID"}),n.jsx(H,{children:"Unidade"}),n.jsx(H,{children:"Tipo"}),n.jsx(H,{children:"Pessoa"}),n.jsx(H,{children:"Nº Pedido"}),n.jsx(H,{children:"Status Pedido"}),n.jsx(H,{children:"Status Retirada"}),n.jsx(H,{align:"right",children:"Total"}),n.jsx(H,{children:"Email"}),n.jsx(H,{children:"Telefones"}),n.jsx(H,{children:"ID Lello"})]})}),n.jsx(A,{children:L?n.jsx($,{children:n.jsx(D,{colSpan:12,align:"center",sx:{py:3},children:n.jsx(m,{size:40})})}):_e.length>0?_e.map((e=>n.jsxs(J,{children:[n.jsx(D,{sx:{width:100,minWidth:100},children:n.jsxs(u,{sx:{display:"flex",gap:1,justifyContent:"start"},children:[n.jsx(g,{color:"primary",onClick:()=>$e(e),size:"small",children:n.jsx(U,{})}),("Pago"===e.status_carrinho||"Aberto"===e.status_carrinho)&&e.celular&&n.jsx(g,{color:"Pago"===e.status_carrinho?"success":"primary",onClick:async()=>await ze(e,e.status_carrinho||"Aberto"),size:"small",title:`Enviar ${"Pago"===e.status_carrinho?"instruções de retirada":"dados para pagamento"} por WhatsApp`,children:n.jsx(q,{})})]})}),n.jsx(D,{children:e.id_unidade}),n.jsx(D,{children:e.nomeunidade}),n.jsx(D,{children:e.tipo}),n.jsx(D,{children:e.pessoa}),n.jsx(D,{children:e.id_carrinho||"-"}),n.jsx(D,{children:e.status_carrinho?n.jsx(Q,{status:e.status_carrinho,children:e.status_carrinho}):"-"}),n.jsx(D,{children:e.status_retirada?n.jsx(X,{status:e.status_retirada,children:e.status_retirada}):"-"}),n.jsx(D,{align:"right",children:e.total_carrinho?Ie(e.total_carrinho):"-"}),n.jsx(D,{children:e.email}),n.jsx(D,{children:[e.celular,e.fone,e.comercial].filter((e=>e)).join(" / ")}),n.jsx(D,{children:e.idunidade})]},e.id_unidade))):n.jsx($,{children:n.jsx(D,{colSpan:12,align:"center",children:"Nenhuma unidade encontrada"})})})]})})}),n.jsx(I,{rowsPerPageOptions:[5,10,25,50],component:"div",count:e.length,rowsPerPage:ee,page:Y,onPageChange:(e,a)=>{Z(a)},onRowsPerPageChange:e=>{ae(parseInt(e.target.value,10)),Z(0)},labelRowsPerPage:"Itens por página",labelDisplayedRows:({from:e,to:a,count:t})=>`${e}-${a} de ${t}`})]}),n.jsxs(R,{open:te,onClose:()=>De(),maxWidth:"md",fullWidth:!0,children:[n.jsxs(z,{children:[fe?"Editar":"Novo"," Carrinho de Compras - ",null==se?void 0:se.nomeunidade," (",null==se?void 0:se.tipo,") - ",null==se?void 0:se.pessoa,fe&&be&&n.jsxs(h,{variant:"subtitle2",color:"text.secondary",children:["Pedido #",be]})]}),n.jsxs(T,{children:[Pe&&n.jsx(p,{severity:"error",sx:{mb:2},children:Pe}),n.jsxs(u,{sx:{mt:2},children:[n.jsxs(u,{sx:{display:"flex",flexDirection:{xs:"column",sm:"row"},gap:2,mb:3},children:[n.jsx(u,{sx:{flex:1},children:n.jsx(y,{fullWidth:!0,type:"datetime-local",label:"Data",value:(e=>{const a=e.getTimezoneOffset();return new Date(e.getTime()-60*a*1e3).toISOString().slice(0,16)})(he),onChange:e=>{try{const a=new Date(e.target.value);isNaN(a.getTime())||xe(a)}catch(a){}},InputLabelProps:{shrink:!0}})}),n.jsx(u,{sx:{flex:1},children:n.jsxs(y,{select:!0,fullWidth:!0,label:"Status",value:pe,onChange:e=>je(e.target.value),SelectProps:{native:!0},children:[n.jsx("option",{value:"Aberto",children:"Aberto"}),n.jsx("option",{value:"Pago",children:"Pago"}),n.jsx("option",{value:"Cancelado",children:"Cancelado"})]})}),n.jsx(u,{sx:{flex:1},children:n.jsxs(y,{select:!0,fullWidth:!0,label:"Status de Retirada",value:me,onChange:e=>ge(e.target.value),SelectProps:{native:!0},children:[n.jsx("option",{value:"Aguardando",children:"Aguardando"}),n.jsx("option",{value:"Separado",children:"Separado"}),n.jsx("option",{value:"Retirado",children:"Retirado"}),n.jsx("option",{value:"Cancelado",children:"Cancelado"})]})})]}),n.jsx(h,{variant:"h6",gutterBottom:!0,children:"Produtos Disponíveis"}),n.jsx(w,{component:x,sx:{mt:2},children:n.jsxs(C,{size:"small",children:[n.jsx(_,{children:n.jsxs($,{children:[n.jsx(H,{children:"ID"}),n.jsx(H,{children:"Descrição"}),n.jsx(H,{align:"center",children:"Quantidade"}),n.jsx(H,{align:"right",children:"Valor"}),n.jsx(H,{align:"right",children:"Total"})]})}),n.jsx(A,{children:le?n.jsx($,{children:n.jsx(D,{colSpan:5,align:"center",sx:{py:3},children:n.jsx(m,{size:40})})}):oe.length>0?oe.map((e=>n.jsxs(J,{children:[n.jsx(D,{children:e.id_produto}),n.jsx(D,{children:e.descricao}),n.jsx(D,{align:"center",children:n.jsxs(u,{sx:{display:"flex",alignItems:"center",justifyContent:"center",gap:1},children:[n.jsx(g,{size:"small",onClick:()=>{return a=e.id_produto,void ue((e=>({...e,[a]:Math.max(0,(e[a]||0)-1)})));var a},color:"primary",children:n.jsx(O,{})}),n.jsx(y,{type:"number",size:"small",value:ce[e.id_produto]||0,onChange:a=>{return t=e.id_produto,r=Number(a.target.value),void ue((e=>({...e,[t]:r})));var t,r},inputProps:{min:0,style:{textAlign:"center"}},sx:{width:"80px"}}),n.jsx(g,{size:"small",onClick:()=>{return a=e.id_produto,void ue((e=>({...e,[a]:(e[a]||0)+1})));var a},color:"primary",children:n.jsx(W,{})})]})}),n.jsx(D,{align:"right",children:Ie(e.valor)}),n.jsx(D,{align:"right",sx:{fontWeight:"bold"},children:Ie(e.valor*(ce[e.id_produto]||0))})]},e.id_produto))):n.jsx($,{children:n.jsx(D,{colSpan:5,align:"center",children:"Nenhum produto encontrado"})})}),n.jsx(F,{children:n.jsxs($,{children:[n.jsx(D,{colSpan:4,align:"right",sx:{fontWeight:"bold",fontSize:"1.1em"},children:"Total Geral:"}),n.jsx(D,{align:"right",sx:{fontWeight:"bold",fontSize:"1.1em",color:"primary.main"},children:Ie(Re())})]})})]})})]})]}),n.jsxs(N,{children:[n.jsx(f,{onClick:()=>De(),disabled:L,children:"Cancelar"}),n.jsx(f,{variant:"contained",color:"success",disabled:0===Re()||L,onClick:async()=>{var e,a,t;if(se)try{M(!0),Se("");const e=Object.entries(ce).filter((([e,a])=>a>0)).map((([e,a])=>({id_produto:Number(e),quantidade:a})));if(0===e.length)return void Se("Adicione pelo menos um produto ao carrinho");const a={id_unidade:se.id_unidade,data:(t=he,t.toLocaleDateString("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit"}).replace(",","")),total:Re(),status:pe,status_retirada:me,itens:e};let r;fe&&be?(r=await G.atualizar(be,a),alert(`Pedido #${be} atualizado com sucesso!`)):(r=await G.criar(a),alert(`Pedido #${r.id_carrinho} criado com sucesso!`)),De(),await we()}catch(r){let t="Erro ao salvar carrinho";r.response?t=(null==(e=r.response.data)?void 0:e.error)||(null==(a=r.response.data)?void 0:a.message)||t:r.message&&(t=r.message),Se(`${t}. Por favor, tente novamente.`)}finally{M(!1)}else Se("Unidade não selecionada")},sx:{fontWeight:"bold",minWidth:150},children:L?n.jsxs(u,{sx:{display:"flex",alignItems:"center",gap:1},children:[n.jsx(m,{size:20,color:"inherit"}),n.jsx("span",{children:"Salvando..."})]}):"Finalizar Pedido"})]})]})]})}export{K as default};
//# sourceMappingURL=Unidades-Cy7pB1Yp.js.map
