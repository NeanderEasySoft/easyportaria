var e=Object.defineProperty,a=(a,t,s)=>((a,t,s)=>t in a?e(a,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):a[t]=s)(a,"symbol"!=typeof t?t+"":t,s);import{g as t,e as s,u as r,j as n,s as o,a as i,f as l,c as d,b as c,B as u,T as h,d as x,A as p,F as m,h as j,C as g,i as f}from"./index-CO_xUdKM.js";import{b}from"./vendor-B0SxJBnB.js";import{T as v,a as y,I as w,S as P,b as S,c as C,d as _,e as $,f as A,g as W,h as I,D,i as R,j as k,A as T,k as z,P as N}from"./produtos.service-JqK6Iw0g.js";import{S as U}from"./ShoppingCart-CIjvCudX.js";function E(e){return t("MuiTableFooter",e)}s("MuiTableFooter",["root"]);const L=o("tfoot",{name:"MuiTableFooter",slot:"Root",overridesResolver:(e,a)=>a.root})({display:"table-footer-group"}),M={variant:"footer"},B="tfoot",F=b.forwardRef((function(e,a){const t=r({props:e,name:"MuiTableFooter"}),{className:s,component:o=B,...d}=t,c={...t,component:o},u=(e=>{const{classes:a}=e;return l({root:["root"]},E,a)})(c);return n.jsx(v.Provider,{value:M,children:n.jsx(L,{as:o,className:i(u.root,s),ref:a,role:o===B?null:"rowgroup",ownerState:c,...d})})})),O=d(n.jsx("path",{d:"M19 13H5v-2h14z"})),q=d(n.jsx("path",{d:"M16.75 13.96c.25.13.41.2.46.3.06.11.04.61-.21 1.18-.2.56-1.24 1.1-1.7 1.12-.46.02-.47.36-2.96-.73-2.49-1.09-3.99-3.75-4.11-3.92-.12-.17-.96-1.38-.92-2.61.05-1.22.69-1.8.95-2.04.24-.26.51-.29.68-.26h.47c.15 0 .36-.06.55.45l.69 1.87c.06.13.1.28.01.44l-.27.41-.39.42c-.12.12-.26.25-.12.5.12.26.62 1.09 1.32 1.78.91.88 1.71 1.17 1.95 1.3.24.14.39.12.54-.04l.81-.94c.19-.25.35-.19.58-.11l1.67.88M12 2a10 10 0 0 1 10 10 10 10 0 0 1-10 10c-1.97 0-3.8-.57-5.35-1.55L2 22l1.55-4.65A9.969 9.969 0 0 1 2 12 10 10 0 0 1 12 2m0 2a8 8 0 0 0-8 8c0 1.72.54 3.31 1.46 4.61L4.5 19.5l2.89-.96A7.95 7.95 0 0 0 12 20a8 8 0 0 0 8-8 8 8 0 0 0-8-8z"})),X=async e=>{try{console.log("Iniciando busca com filtros:",e);return(await c.get("/api/v1/unidades",{params:e})).data}catch(a){throw console.error("Erro na busca:",a),a}};const V=new class{constructor(){a(this,"baseUrl","/api/v1/carrinhos")}async listar(){return(await c.get(this.baseUrl)).data}async buscarPorId(e){return(await c.get(`${this.baseUrl}/${e}`)).data}async buscarPorUnidade(e){return(await c.get(`${this.baseUrl}/unidade/${e}`)).data}async criar(e){return(await c.post(this.baseUrl,e)).data}async atualizar(e,a){return(await c.put(`${this.baseUrl}/${e}`,a)).data}async atualizarStatus(e,a){return(await c.patch(`${this.baseUrl}/${e}/status`,{status:a})).data}async atualizarStatusRetirada(e,a){return(await c.patch(`${this.baseUrl}/${e}/status-retirada`,{status_retirada:a})).data}async excluir(e){await c.delete(`${this.baseUrl}/${e}`)}},G=o(W)((({theme:e})=>({"&.MuiTableCell-head":{backgroundColor:e.palette.primary.main,color:e.palette.common.white,fontWeight:"bold"}}))),H=o($)((({theme:e})=>({"&:nth-of-type(odd)":{backgroundColor:e.palette.action.hover},"&:hover":{backgroundColor:e.palette.action.selected}}))),J=o("span")((({status:e})=>{let a="#e0e0e0",t="#000000";switch(e){case"Ativo":a="#4caf50",t="#ffffff";break;case"Inativo":a="#f44336",t="#ffffff"}return{backgroundColor:a,color:t,padding:"3px 10px",borderRadius:"12px",display:"inline-block",fontSize:"0.875rem",fontWeight:"500"}})),Q=o("span")((({status:e})=>{let a="#e0e0e0",t="#000000";switch(e){case"Retirado":a="#4caf50",t="#ffffff";break;case"Não Retirado":a="#f44336",t="#ffffff"}return{backgroundColor:a,color:t,padding:"3px 10px",borderRadius:"12px",display:"inline-block",fontSize:"0.875rem",fontWeight:"500"}}));function K(){const[e,a]=b.useState([]),[t,s]=b.useState(""),[r,o]=b.useState(""),[i,l]=b.useState(""),[d,c]=b.useState(""),[v,E]=b.useState(""),[L,M]=b.useState(!1),[B,K]=b.useState(""),[Y,Z]=b.useState(0),[ee,ae]=b.useState(10),[te,se]=b.useState(!1),[re,ne]=b.useState(null),[oe,ie]=b.useState([]),[le,de]=b.useState(!1),[ce,ue]=b.useState({}),[he,xe]=b.useState(new Date),[pe,me]=b.useState("Aberto"),[je,ge]=b.useState("Aguardando"),[fe,be]=b.useState(!1),[ve,ye]=b.useState(null),[we,Pe]=b.useState(""),Se=async()=>{try{M(!0),K("");const e={};t&&(e.nomeunidade=t),r&&(e.pessoa=r),i&&(e.id_carrinho=Number(i)),d&&(e.status_carrinho=d),v&&(e.status_retirada=v);const s=[...await X(e)].sort(((e,a)=>e.nomeunidade.localeCompare(a.nomeunidade,"pt-BR")));a(s),Z(0)}catch(e){K(`Erro ao buscar unidades: ${e.message}`)}finally{M(!1)}},Ce=async()=>{try{de(!0);const e=await N.listar();ie(e.filter((e=>"Ativo"===e.status)))}catch(e){K(`Erro ao carregar produtos: ${e.message}`)}finally{de(!1)}};b.useEffect((()=>{const e=setTimeout((()=>{Se()}),500);return()=>clearTimeout(e)}),[t,r,i,d,v]);const _e=e.slice(Y*ee,Y*ee+ee),$e=async e=>{var a,t,s;try{M(!0),Pe(""),ne(e);const a=(await V.buscarPorUnidade(e.id_unidade))[0];if(a){const e=await V.buscarPorId(a.id_carrinho);ye(a.id_carrinho),be(!0),xe((e=>{const[a,t]=e.split(" "),[s,r,n]=a.split("/"),[o,i]=t.split(":");return new Date(Number(n),Number(r)-1,Number(s),Number(o),Number(i))})(a.data)),me(a.status),ge(a.status_retirada),await Ce();const t=e.itens.reduce(((e,a)=>({...e,[a.id_produto]:a.quantidade})),{});ue(t)}else await Ae();se(!0)}catch(r){if(404!==(null==(a=r.response)?void 0:a.status)){let e="Erro ao carregar carrinho";(null==(s=null==(t=r.response)?void 0:t.data)?void 0:s.error)?e=r.response.data.error:r.message&&(e=r.message),Pe(e)}else await Ae(),se(!0)}finally{M(!1)}},Ae=async()=>{ye(null),be(!1),xe(new Date),me("Aberto"),ge("Aguardando"),ue({}),await Ce()},We=async()=>{se(!1),ne(null),be(!1),xe(new Date),me("Aberto"),ge("Aguardando"),ue({}),ye(null),Pe(""),Se()},Ie=e=>e.toLocaleString("pt-BR",{style:"currency",currency:"BRL"}),De=()=>oe.reduce(((e,a)=>{const t=ce[a.id_produto]||0;return e+a.valor*t}),0),Re=async(e,a)=>{if(e.celular)try{const t=e.celular.replace(/\D/g,""),s=await(async(e,a,t,s)=>{let r="";const n=ve||e.id_carrinho;"Pago"===s?(r=`Olá ${e.pessoa}!\n\n`,r+=`Seu pedido ${n?`#${n}`:""} está pronto para retirada.\n\n`,r+="*Instruções de Retirada:*\n",r+="1. Dirija-se ao local de retirada\n",n&&(r+=`2. Informe o número do seu pedido: #${n}\n`),r+=`3. Status atual: ${je}\n\n`,r+="*Dados do Cliente:*\n",r+=`Unidade: ${e.nomeunidade}\n`,r+=`Pessoa: ${e.pessoa}\n`,r+=`Tipo: ${e.tipo}\n\n`,r+="*Detalhes do Pedido:*\n"):(r=`Olá ${e.pessoa}!\n\n`,r+="*Dados do Cliente:*\n",r+=`Unidade: ${e.nomeunidade}\n`,r+=`Pessoa: ${e.pessoa}\n`,r+=`Tipo: ${e.tipo}\n\n`,r+="*Detalhes do Pedido:*\n");let o=a,i=t;if(!te&&e.id_carrinho)try{const a=await V.buscarPorId(e.id_carrinho);a&&(o=(await N.listar()).filter((e=>"Ativo"===e.status)),i=a.itens.reduce(((e,a)=>({...e,[a.id_produto]:a.quantidade})),{}))}catch(d){console.error("Erro ao buscar detalhes do carrinho:",d)}let l=0;return o.forEach((e=>{const a=i[e.id_produto]||0;if(a>0){const t=e.valor*a;l+=t,r+=`- ${e.descricao}: ${a} x ${Ie(e.valor)} = ${Ie(t)}\n`}})),r+=`\n*Total: ${Ie(l)}*`,"Aberto"===s&&(r+="\n\nChave PIX (CNPJ): 25.044.410/0001-65",n&&(r+=`\n\nFavor incluir na descrição: Pedido #${n}`)),encodeURIComponent(r)})(e,oe,ce,a),r=`https://wa.me/55${t}?text=${s}`;window.open(r,"_blank")}catch(t){console.error("Erro ao enviar mensagem:",t),alert("Erro ao preparar a mensagem. Por favor, tente novamente.")}else alert("Esta unidade não possui número de celular cadastrado.")};return n.jsxs(u,{sx:{p:0,m:0,width:"100%"},children:[n.jsx(h,{variant:"h4",component:"h1",gutterBottom:!0,sx:{color:"primary.main",fontWeight:"medium"},children:"Venda de Pulseiras"}),n.jsx(x,{sx:{p:2,mb:3},children:n.jsxs(u,{sx:{display:"flex",flexDirection:{xs:"column",md:"row"},gap:2,alignItems:"stretch"},children:[n.jsx(u,{sx:{flex:1},children:n.jsx(y,{fullWidth:!0,label:"Nome da Unidade",value:t,onChange:e=>s(e.target.value),InputProps:{startAdornment:n.jsx(w,{position:"start",children:n.jsx(P,{})})}})}),n.jsx(u,{sx:{flex:1},children:n.jsx(y,{fullWidth:!0,label:"Nome da Pessoa",value:r,onChange:e=>o(e.target.value),InputProps:{startAdornment:n.jsx(w,{position:"start",children:n.jsx(P,{})})}})}),n.jsx(u,{sx:{flex:1},children:n.jsx(y,{fullWidth:!0,label:"Nº do Pedido",value:i,onChange:e=>{const a=e.target.value.replace(/\D/g,"");l(a)},InputProps:{startAdornment:n.jsx(w,{position:"start",children:n.jsx(P,{})})}})}),n.jsx(u,{sx:{flex:1},children:n.jsxs(y,{fullWidth:!0,select:!0,label:"Status do Pedido",value:d,onChange:e=>c(e.target.value),SelectProps:{native:!0},InputLabelProps:{shrink:!0},children:[n.jsx("option",{value:"",children:"Todos"}),n.jsx("option",{value:"Sem Pedido",children:"Sem Pedido"}),n.jsx("option",{value:"Aberto",children:"Aberto"}),n.jsx("option",{value:"Pago",children:"Pago"}),n.jsx("option",{value:"Cancelado",children:"Cancelado"})]})}),n.jsx(u,{sx:{flex:1},children:n.jsxs(y,{fullWidth:!0,select:!0,label:"Status de Retirada",value:v,onChange:e=>E(e.target.value),SelectProps:{native:!0},InputLabelProps:{shrink:!0},children:[n.jsx("option",{value:"",children:"Todos"}),n.jsx("option",{value:"Sem Pedido",children:"Sem Pedido"}),n.jsx("option",{value:"Aguardando",children:"Aguardando"}),n.jsx("option",{value:"Separado",children:"Separado"}),n.jsx("option",{value:"Retirado",children:"Retirado"}),n.jsx("option",{value:"Cancelado",children:"Cancelado"})]})})]})}),B&&n.jsx(p,{severity:"error",sx:{mb:2},children:B}),n.jsxs(x,{children:[n.jsx(m,{in:!L,timeout:L?0:1e3,children:n.jsx(S,{sx:{width:"100%",overflowX:"auto"},children:n.jsxs(C,{children:[n.jsx(_,{children:n.jsxs($,{children:[n.jsx(G,{sx:{width:100,minWidth:100},children:"Ações"}),n.jsx(G,{sx:{display:{xs:"none",md:"table-cell"}},children:"ID"}),n.jsx(G,{children:"Unidade"}),n.jsx(G,{sx:{display:{xs:"none",md:"table-cell"}},children:"Tipo"}),n.jsx(G,{children:"Pessoa"}),n.jsx(G,{children:"Nº Pedido"}),n.jsx(G,{children:"Status Pedido"}),n.jsx(G,{children:"Status Retirada"}),n.jsx(G,{align:"right",sx:{display:{xs:"none",md:"table-cell"}},children:"Total"}),n.jsx(G,{sx:{display:{xs:"none",md:"table-cell"}},children:"Email"}),n.jsx(G,{sx:{display:{xs:"none",md:"table-cell"}},children:"Telefones"}),n.jsx(G,{sx:{display:{xs:"none",md:"table-cell"}},children:"ID Lello"})]})}),n.jsx(A,{children:_e.map((e=>n.jsxs(H,{children:[n.jsx(W,{sx:{width:100,minWidth:100},children:n.jsxs(u,{sx:{display:"flex",gap:1,justifyContent:"start",flexWrap:{xs:"wrap",sm:"nowrap"}},children:[n.jsx(j,{color:"primary",onClick:()=>$e(e),size:"small",children:n.jsx(U,{})}),("Pago"===e.status_carrinho||"Aberto"===e.status_carrinho)&&e.celular&&n.jsx(j,{color:"Pago"===e.status_carrinho?"success":"primary",onClick:async()=>await Re(e,e.status_carrinho||"Aberto"),size:"small",title:`Enviar ${"Pago"===e.status_carrinho?"instruções de retirada":"dados para pagamento"} por WhatsApp`,children:n.jsx(q,{})})]})}),n.jsx(W,{sx:{display:{xs:"none",md:"table-cell"}},children:e.id_unidade}),n.jsx(W,{children:e.nomeunidade}),n.jsx(W,{sx:{display:{xs:"none",md:"table-cell"}},children:e.tipo}),n.jsx(W,{sx:{whiteSpace:{xs:"normal",md:"nowrap"},wordBreak:"break-word",maxWidth:{xs:120,md:"initial"},overflowWrap:"break-word"},children:e.pessoa}),n.jsx(W,{children:e.id_carrinho||"-"}),n.jsx(W,{children:e.status_carrinho?n.jsx(J,{status:e.status_carrinho,children:e.status_carrinho}):"-"}),n.jsx(W,{children:e.status_retirada?n.jsx(Q,{status:e.status_retirada,children:e.status_retirada}):"-"}),n.jsx(W,{align:"right",sx:{display:{xs:"none",md:"table-cell"}},children:e.total_carrinho?Ie(e.total_carrinho):"-"}),n.jsx(W,{sx:{display:{xs:"none",md:"table-cell"}},children:e.email}),n.jsx(W,{sx:{display:{xs:"none",md:"table-cell"}},children:[e.celular,e.fone,e.comercial].filter((e=>e)).join(" / ")}),n.jsx(W,{sx:{display:{xs:"none",md:"table-cell"}},children:e.idunidade})]},e.id_unidade)))})]})})}),n.jsx(I,{rowsPerPageOptions:[5,10,25,50],component:"div",count:e.length,rowsPerPage:ee,page:Y,onPageChange:(e,a)=>{Z(a)},onRowsPerPageChange:e=>{ae(parseInt(e.target.value,10)),Z(0)},labelRowsPerPage:"Itens por página",labelDisplayedRows:({from:e,to:a,count:t})=>`${e}-${a} de ${t}`})]}),n.jsxs(D,{open:te,onClose:()=>We(),maxWidth:"md",fullWidth:!0,children:[n.jsxs(R,{children:[fe?"Editar":"Novo"," Carrinho de Compras - ",null==re?void 0:re.nomeunidade," (",null==re?void 0:re.tipo,") - ",null==re?void 0:re.pessoa,fe&&ve&&n.jsxs(h,{variant:"subtitle2",color:"text.secondary",children:["Pedido #",ve]})]}),n.jsxs(k,{sx:{px:{xs:1,sm:3}},children:[we&&n.jsx(p,{severity:"error",sx:{mb:2},children:we}),n.jsxs(u,{sx:{mt:2},children:[n.jsxs(u,{sx:{display:"flex",flexDirection:{xs:"column",sm:"row"},gap:2,mb:3},children:[n.jsx(u,{sx:{flex:1},children:n.jsx(y,{fullWidth:!0,type:"datetime-local",label:"Data",value:(e=>{const a=e.getTimezoneOffset();return new Date(e.getTime()-60*a*1e3).toISOString().slice(0,16)})(he),onChange:e=>{try{const a=new Date(e.target.value);isNaN(a.getTime())||xe(a)}catch(a){}},InputLabelProps:{shrink:!0}})}),n.jsx(u,{sx:{flex:1},children:n.jsxs(y,{select:!0,fullWidth:!0,label:"Status",value:pe,onChange:e=>me(e.target.value),SelectProps:{native:!0},children:[n.jsx("option",{value:"Aberto",children:"Aberto"}),n.jsx("option",{value:"Pago",children:"Pago"}),n.jsx("option",{value:"Cancelado",children:"Cancelado"})]})}),n.jsx(u,{sx:{flex:1},children:n.jsxs(y,{select:!0,fullWidth:!0,label:"Status de Retirada",value:je,onChange:e=>ge(e.target.value),SelectProps:{native:!0},children:[n.jsx("option",{value:"Aguardando",children:"Aguardando"}),n.jsx("option",{value:"Separado",children:"Separado"}),n.jsx("option",{value:"Retirado",children:"Retirado"}),n.jsx("option",{value:"Cancelado",children:"Cancelado"})]})})]}),n.jsx(h,{variant:"h6",gutterBottom:!0,children:"Produtos Disponíveis"}),n.jsx(S,{component:x,sx:{mt:2,overflowX:"auto"},children:n.jsxs(C,{size:"small",sx:{minWidth:600},children:[n.jsx(_,{children:n.jsxs($,{children:[n.jsx(G,{children:"ID"}),n.jsx(G,{children:"Descrição"}),n.jsx(G,{align:"center",children:"Quantidade"}),n.jsx(G,{align:"right",children:"Valor"}),n.jsx(G,{align:"right",children:"Total"})]})}),n.jsx(A,{children:le?n.jsx($,{children:n.jsx(W,{colSpan:5,align:"center",sx:{py:3},children:n.jsx(g,{size:40})})}):oe.length>0?oe.map((e=>n.jsxs(H,{children:[n.jsx(W,{children:e.id_produto}),n.jsx(W,{children:e.descricao}),n.jsx(W,{align:"center",children:n.jsxs(u,{sx:{display:"flex",alignItems:"center",justifyContent:"center",gap:1},children:[n.jsx(j,{size:"small",onClick:()=>{return a=e.id_produto,void ue((e=>({...e,[a]:Math.max(0,(e[a]||0)-1)})));var a},color:"primary",children:n.jsx(O,{})}),n.jsx(y,{type:"number",size:"small",value:ce[e.id_produto]||0,onChange:a=>{return t=e.id_produto,s=Number(a.target.value),void ue((e=>({...e,[t]:s})));var t,s},inputProps:{min:0,style:{textAlign:"center"}},sx:{width:"80px"}}),n.jsx(j,{size:"small",onClick:()=>{return a=e.id_produto,void ue((e=>({...e,[a]:(e[a]||0)+1})));var a},color:"primary",children:n.jsx(T,{})})]})}),n.jsx(W,{align:"right",children:Ie(e.valor)}),n.jsx(W,{align:"right",sx:{fontWeight:"bold"},children:Ie(e.valor*(ce[e.id_produto]||0))})]},e.id_produto))):n.jsx($,{children:n.jsx(W,{colSpan:5,align:"center",children:"Nenhum produto encontrado"})})}),n.jsx(F,{children:n.jsxs($,{children:[n.jsx(W,{colSpan:4,align:"right",sx:{fontWeight:"bold",fontSize:"1.1em"},children:"Total Geral:"}),n.jsx(W,{align:"right",sx:{fontWeight:"bold",fontSize:"1.1em",color:"primary.main"},children:Ie(De())})]})})]})})]})]}),n.jsxs(z,{children:[n.jsx(f,{onClick:()=>We(),disabled:L,children:"Cancelar"}),n.jsx(f,{variant:"contained",color:"success",disabled:0===De()||L,onClick:async()=>{var e,a,t;if(re)try{M(!0),Pe("");const e=Object.entries(ce).filter((([e,a])=>a>0)).map((([e,a])=>({id_produto:Number(e),quantidade:a})));if(0===e.length)return void Pe("Adicione pelo menos um produto ao carrinho");const a={id_unidade:re.id_unidade,data:(t=he,t.toLocaleDateString("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit"}).replace(",","")),total:De(),status:pe,status_retirada:je,itens:e};let s;fe&&ve?(s=await V.atualizar(ve,a),alert(`Pedido #${ve} atualizado com sucesso!`)):(s=await V.criar(a),alert(`Pedido #${s.id_carrinho} criado com sucesso!`)),We(),await Se()}catch(s){let t="Erro ao salvar carrinho";s.response?t=(null==(e=s.response.data)?void 0:e.error)||(null==(a=s.response.data)?void 0:a.message)||t:s.message&&(t=s.message),Pe(`${t}. Por favor, tente novamente.`)}finally{M(!1)}else Pe("Unidade não selecionada")},sx:{fontWeight:"bold",minWidth:150},children:L?n.jsxs(u,{sx:{display:"flex",alignItems:"center",gap:1},children:[n.jsx(g,{size:20,color:"inherit"}),n.jsx("span",{children:"Salvando..."})]}):"Finalizar Pedido"})]})]})]})}export{K as default};
//# sourceMappingURL=Unidades-SZktg1PE.js.map
